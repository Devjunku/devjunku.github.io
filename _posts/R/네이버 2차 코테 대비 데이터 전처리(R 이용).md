---
title:  "ë„¤ì´ë²„ 2ì°¨ ì½”í…Œ ëŒ€ë¹„ ë°ì´í„° ì „ì²˜ë¦¬(R ì´ìš©)"
excerpt: "Date Analysis"

tags:
  - [Gitlog, jekyll, Github, Git, R, Data, Analysis]

toc: true
toc_sticky: true
 
date: 2021-07-09
last_modified_at: 2021-07-09
---
# ğŸŸ¢ ë„¤ì´ë²„ 2ì°¨ ì½”í…Œ ëŒ€ë¹„ ë°ì´í„° ì „ì²˜ë¦¬(R ì´ìš©)

ë³¸ í¬ìŠ¤íŒ…ì— ì´ìš©ë˜ëŠ” ë°ì´í„° ì²˜ë¦¬ ë¬¸ì œë“¤ì€ `Do it! ì‰½ê²Œ ë°°ìš°ëŠ” R ë°ì´í„° ë¶„ì„(ê¹€ì˜ìš° ì €)`ì— ê·¼ê±°í•©ë‹ˆë‹¤.

2ì°¨ ê³¼ì œ ì•ˆë‚´ê°€ ë©”ì¼ë¡œ ì™”ê³  ì²´í—˜í•˜ê¸°ë¥¼ ë“¤ì–´ê°€ë³´ë‹ˆ, ë°ì´í„° ì²˜ë¦¬ ê´€ë ¨ ë‚´ìš©ì´ ì£¼ë¥¼ ì´ë¤˜ë‹¤. 1ì¼ ë‚¨ì€ ìƒíƒœì—ì„œ í•œë‹¤ê³  í•´ì„œ ë¬´ì—‡ì´ ë‚˜ì•„ì§€ê² ëŠ”ê°€? ë¼ê³  ìƒê°ë„ ë“¤ì§€ë§Œ, ì§€í‘¸ë¼ê¸°ë¼ë„ ì¡ëŠ” ì‹¬ì •ìœ¼ë¡œ ë°ì´í„° ì „ì²˜ë¦¬ ë¬¸ì œë¼ë„ ì œëŒ€ë¡œ í’€ê³ ìí•˜ëŠ” ìƒê°ì— ì˜¤ëŠ˜ì€ Rì„ ì´ìš©í•˜ì—¬ SQLê³¼ ë¹„ìŠ·í•œ ë°ì´í„° ì „ì²˜ë¦¬ì¸ DMLì„ ê³µë¶€í•´ë³´ê³ ì í•œë‹¤.

Rì€ SQL ë¬¸ë²•ì„ ì§ì ‘ ì§€ì›í•˜ì§€ëŠ” ì•ŠëŠ” ê²ƒìœ¼ë¡œ ì•Œê³  ìˆë‹¤. ê·¸ë˜ì„œ sql ë¬¸ë²•ì„ ì ìš©í•˜ê³ ì í•œë‹¤ë©´, `sqldf` packageë¥¼ í™œìš©í•´ì•¼ í•œë‹¤. ë¬¼ë¡   ì´ì™€ ì•„ì£¼ ë¹„ìŠ·í•œ ê²ƒìœ¼ë¡œ `dplyr`ì´ë¼ëŠ” íŒ¨í‚¤ì§€ê°€ ìˆë‹¤. ì´ ëª¨ë‘ ë°ì´í„° ì „ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ë‹¤ ë¹ ë¥´ê²Œ ì›í•˜ëŠ” ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤. ì—¬ëŸ¬ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ `dplyr` íŒ¨í‚¤ì§€ì˜ ë“±ì¥ìœ¼ë¡œ ì¸í•´ sqlì´ ì´ì œ í˜ë“¤ì–´ì§ˆ ê²ƒì´ë‹¤. ë­ ì´ëŸ° ì´ì•¼ê¸°ë¥¼ ë“¤ì—ˆëŠ”ë°, íƒë„ ì—†ëŠ” ì†Œë¦¬ë‹¤. DB ì ‘ê·¼ ì–¸ì–´ ì¤‘ sql ë§Œí¼ ê°„í¸í•œ queryëŠ” ë³¸ì ì´ ì—†ê¸° ë•Œë¬¸ì— ì‚¬ë¼ì§€ì§€ ì•ŠëŠ”ë‹¤ì— í•œí‘œ ê±´ë‹¤. ì—¬íŠ¼ ë°”ë¡œ ì‹œì‘

Rì—ì„œ `dplyr` íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•  ë•Œ ë§ì´ ì‚¬ìš©í•˜ëŠ” ì—°ì‚°ìê°€ ë“±ì¥í•˜ëŠ” ë°, ë¬¼ë¡  í•­ìƒ ì´ë•Œë§Œ ì‚¬ìš©í•˜ëŠ”ê±´ ì•„ë‹ˆì§€ë§Œ, `%>%`ì´ë‹¤. `%>%`ì˜ ì˜ë¯¸ëŠ” ì•ì˜ ë°ì´í„°ë¥¼ ì´í›„ì— ë‚˜ì˜¤ëŠ” í•¨ìˆ˜ì˜ ì¸ìë¡œ ë„˜ê²¨ì¤€ë‹¤ëŠ” ê²ƒì´ë‹¤. ë”°ë¼ì„œ ì• ì¸ìì˜ ë°ì´í„°ì— ë“¤ì–´ìˆëŠ” ì—´ì˜ ì´ë¦„ ë“±ì„ `$`, `[]` ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ì“¸ ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ê°„í¸í•¨ì´ ìˆê¸° ë•Œë¬¸ì— ë°ì´í„° ì „ì²˜ë¦¬ì— ë§ì´ ì‚¬ìš©ë˜ëŠ”ê±° ê°™ë‹¤.

18ë…„ ìƒë°˜ê¸°ì— í–ˆë˜ ë°ì´í„° ë§ˆì´ë‹ ìˆ˜ì—… ê³¼ì œê°€ ê¸°ì–µë‚œë‹¤. ê·¸ ë•Œ í–ˆë˜ ê³¼ì œì—ì„œë„ ë°ì´í„° ì²˜ë¦¬ë¥¼ ëª¨ë‘ `%>%`ë¥¼ ì‚¬ìš©í–ˆë‹¤. ì•„ì£¼ ì¢‹ì€ ì—°ì‚°ìì´ë‹¤. ê·¸ëŸ¼ ìƒì„¸í•˜ê²Œ `dplyr`ì— ì–´ë–¤ ì „ì²˜ë¦¬ í•¨ìˆ˜ê°€ ë“¤ì–´ìˆëŠ”ì§€ ì •ë¦¬í•´ë³´ì.

1. filter(): í–‰ì¶”ì¶œ -> whereê³¼ ìœ ì‚¬í•˜ë‹¤.
2. select(): ì—´ì¶”ì¶œ -> selectì™€ ìœ ì‚¬
3. arrange(): ì •ë ¬ -> order_byì™€ ìœ ì‚¬
4. mutate(): ë³€ìˆ˜ ì¶”ê°€ -> selectì—ì„œ ìƒˆë¡œìš´ ë³€ìˆ˜ë¥¼ ë§Œë“œëŠ” ê²ƒê³¼ ìœ ì‚¬
5. summarise(): í†µê³„ì¹˜ ì‚°ì¶œ -> ì´ì—­ì‹œ ê·¸ëŸ¼
6. group_by(): ì§‘ë‹¨ë³„ ë‚˜ëˆ„ê¸° -> group_byì™€ ìœ ì‚¬
7. left_join(): ë°ì´í„° í•©ì¹˜ê¸°(ì—´) -> left join, right_joinê³¼ ìœ ì‚¬
8. bind_rows(): ë°ì´í„° í•©ì¹˜ê¸°(í–‰)

ì‹¤ìŠµì„ ìœ„í•´ `ggplot2` íŒ¨í‚¤ì§€ì— ë‚´ì¥ëœ `mpg` ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ìŠµì„ ì§„í–‰í•˜ê² ë‹¤.

```R
# 1
install.packages('ggplot2')
library(ggplot2)
mpg = data.frame(ggplot2::mpg)
```

1ë²ˆ ì½”ë“œë¥¼ ì´ìš©í•˜ì—¬ mpg ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤. ì´ì œ í•˜ë‚˜ì”© ë°ì´í„° ì²˜ë¦¬ë¥¼ í•´ë³´ì.

## âŒ˜ ë°ì´í„° ì •ì œ ë° ì²˜ë¦¬ (select, filter, group_by, arrange, mutate, summarise)

### 1ë²ˆ. ìë™ì°¨ ë°°ê¸°ëŸ‰ì— ë”°ë¼ ê³ ì†ë„ë¡œ ì—°ë¹„ê°€ ë‹¤ë¥¸ì§€ ì•Œì•„ë³´ë ¤ê³  í•©ë‹ˆë‹¤. displ(ë°°ê¸°ëŸ‰)ì´ 4 ì´í•˜ì¸ ìë™ì°¨ 5 ì´ìƒì¸ ìë™ì°¨ ì¤‘ ì–´ë–¤ ìë™ì°¨ì˜ hwy(ê³ ì†ë„ë¡œ ì—°ë¹„)ê°€ í‰ê· ì ìœ¼ë¡œ ë” ë†’ì€ì§€ ì•Œì•„ë³´ì„¸ìš”.

1. displì—´ì—ì„œ 4ì´í•˜, 5ì´ìƒì¸ ìë™ì°¨ë¥¼ ë½‘ì•„ì•¼í•œë‹¤.
2. í‰ê·  ì—°ë¹„ë¥¼ ê³„ì‚°í•´ì•¼í•œë‹¤.

```R
# 2
> mpg4 = mpg %>% filter(displ <= 4)
> mean(mpg4$hwy)
[1] 25.96319
> mpg5 = mpg %>% filter(displ >= 5)
> mean(mpg5$hwy)
[1] 18.07895
```

ê°„ë‹¨í•œ ì—°ì‚°ì´ì—ˆë‹¤.

displ(ë°°ê¸°ëŸ‰)ì´ 4 ì´í•˜ì¸ ìë™ì°¨ê°€ í‰ê·  ê³ ì†ë„ë¡œ ì—°ë¹„ê°€ ë” ë†’ì€ ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¬ë‹¤.

### 2ë²ˆ. ìë™ì ì œì¡° íšŒì‚¬ì— ë”°ë¼ ë„ì‹œ ì—°ë¹„ê°€ ë‹¤ë¥¸ì§€ ì•Œì•„ë³´ë ¤ê³  í•©ë‹ˆë‹¤. "audi", "toyota" ì¤‘ ì–´ëŠ `manufacturer`ì˜ `cty`ê°€ í‰ê· ì ìœ¼ë¡œ ë” ë†’ì€ì§€ ì•Œì•„ë³´ì„¸ìš”.

`manufacturer`ì´ ì•„ìš°ë”” ì´ê±°ë‚˜ ë„ìš”íƒ€ì¸ ê²½ìš°ë¥¼ ì•Œì•„ë´ì•¼í•˜ê¸° ë•Œë¬¸ì—, í–‰ ì¡°ê±´ì¸ filterë¥¼ ê±¸ì–´ì¤€ë‹¤. ì´í›„ `manufacturer`ë¥¼ ê·¸ë£¹ì„ ì§€ì–´ì£¼ê³  ìƒˆë¡œìš´ í†µê³„ì¹˜ë¥¼ ì‚°ì¶œí•˜ë©´ ë˜ê² ë‹¤.

```R
# 3
> cty_mpg_au_to = mpg %>% filter(manufacturer =="audi" | manufacturer=="toyota") %>%
+   group_by(manufacturer) %>% summarise(mean_cty = mean(cty))
> data.frame(cty_mpg_au_to)
  manufacturer mean_cty
1         audi 17.61111
2       toyota 18.52941
```

toyotaì˜ í‰ê·  ë„ì‹œ ì—°ë¹„ê°€ ë” ë†’ì€ ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¬ë‹¤.

### 3ë²ˆ. "chevrolet", "ford", "honda" ìë™ì°¨ì˜ ê³ ì†ë„ë¡œ ì—°ë¹„ í‰ê· ì„ ì•Œì•„ë³´ë ¤ê³  í•©ë‹ˆë‹¤. ì´ íšŒì‚¬ë“¤ì˜ ë°ì´í„°ë¥¼ ì¶”ì¶œí•œ í›„ hwy ì „ì²´ í‰ê· ì„ êµ¬í•´ë³´ì„¸ìš”.

`manufacturer`ì´ ì‰ë³´ë ˆ, í¬ë“œ, í˜¼ë‹¤ì¸ ê²½ìš°ë¥¼ ìƒê°í•´ì•¼í•œë‹¤. ì´ë•Œ |ë¥¼ ì¨ì„œ ë‚˜íƒ€ë‚´ë©´ ì½”ë“œê°€ ê¸¸ì–´ì§€ë¯€ë¡œ %in%ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚˜íƒ€ëƒˆë‹¤. ì´í›„ì—ëŠ” 2ë²ˆê³¼ ê°™ì€ ì½”ë“œë¡œ ì§„í–‰ëœë‹¤.

```R
# 4
> hwy_mpg_ch_fo_ho = mpg %>% filter(manufacturer %in% c('chevrolet', 'ford', 'honda')) %>%
+   group_by(manufacturer) %>% summarise(hwy_mean = mean(hwy))
> data.frame(hwy_mpg_ch_fo_ho)
  manufacturer hwy_mean
1    chevrolet 21.89474
2         ford 19.36000
3        honda 32.55556
```

í˜¼ë‹¤ê°€ ê°€ì¥ ì—°ë¹„ê°€ ê¸¸ì—ˆìœ¼ë©° ì‰ë³´ë ˆ, í¬ë“œ ìˆœì´ë‹¤.

### 4ë²ˆ. mpg ë°ì´í„°ëŠ” 11ê°œ ë³€ìˆ˜ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ ì¤‘ ì¼ë¶€ë§Œ ì¶”ì¶œí•´ ë¶„ì„ì— í™œìš©í•˜ë ¤ê³  í•©ë‹ˆë‹¤. mpg ë°ì´í„°ì—ì„œ class(ìë™ì°¨ ì¢…ë¥˜), cty(ë„ì‹œ ì—°ë¹„) ë³€ìˆ˜ë¥¼ ì¶”ì¶œí•´ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë§Œë“œì„¸ìš”. ìƒˆë¡œ ë§Œë“  ë°ì´í„°ì˜ ì¼ë¶€ë¥¼ ì¶œë ¥í•´ ë‘ ë³€ìˆ˜ë¡œë§Œ êµ¬ì„±ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

ì—´ìœ¼ íƒí•˜ëŠ” ë¬¸ì œì˜€ê³  ë°”ë¡œ selectë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```R
# 5
> mpg_c_c = mpg %>% select(class, cty)
> head(mpg_c_c)
    class cty
1 compact  18
2 compact  21
3 compact  20
4 compact  21
5 compact  16
6 compact  18
```

class, cty ë‘ê°œì˜ ì—´ë§Œ ê³ ë¥´ë©´ ë˜ì—ˆê¸° ë•Œë¬¸ì— ê°„ë‹¨í•œ ë¬¸ì œì˜€ë‹¤.

### 5ë²ˆ. ìë™ì°¨ ì¢…ë¥˜ì— ë”°ë¼ ë„ì‹œ ì—°ë¹„ê°€ ë‹¤ë¥¸ì§€ ì•Œì•„ë³´ë ¤ê³  í•©ë‹ˆë‹¤. ì•ì—ì„œ ì¶”ì¶œí•œ ë°ì´í„°ë¥¼ ì´ìš©í•´ class(ìë™ì°¨ ì¢…ë¥˜)ê°€ "suv"ì¸ ìë™ì°¨ì™€ "compact"ì¸ ìë™ì°¨ ì¤‘ ì–´ë–¤ ìë™ì°¨ì˜ cty(ë„ì‹œ ì—°ë¹„)ê°€ ë” ë†’ì€ì§€ ì•Œì•„ë³´ì„¸ìš”.

filterë¥¼ í†µí•´ classê°€ suvì™€ compactì— ì†í•˜ëŠ” ê²½ìš°ë§Œ ê±¸ëŸ¬ë‚¸ë‹¤. ì´í›„ classì™€ ctyë¥¼ ì„ íƒí•˜ê³  ê·¸ë£¹ì„ ì§€ì–´ì¤€ë‹¤. í•´ë‹¹ ê·¸ë£¹ë³„ë¡œ í‰ê· ê°’ì„ ê³„ì‚°í•´ì£¼ë©´ ë!

```R
# 6
> cty_mpg = mpg %>% filter(class %in% c("suv", "compact")) %>%
+   select(class, cty) %>%  group_by(class) %>%
+   summarise('cty_mean' = mean(cty))
> data.frame(cty_mpg)
    class cty_mean
1 compact 20.12766
2     suv 13.50000
```

### 6ë²ˆ. "audi"ì—ì„œ ìƒì‚°í•œ ìë™ì°¨ ì¤‘ì— ì–´ë–¤ ìë™ì°¨ ëª¨ë¸ì˜ hwy(ê³ ì†ë„ë¡œ ì—°ë¹„)ê°€ ë†’ì€ì§€ ì•Œì•„ë³´ë ¤ê³  í•©ë‹ˆë‹¤. "audi"ì—ì„œ ìƒì‚°í•œ ìë™ì°¨ ì¤‘ hwyê°€ 1~5ìœ„ì— í•´ë‹¹í•˜ëŠ” ìë™ì°¨ì˜ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ì„¸ìš”.

audiì¸ ê²½ìš°ë¥¼ filterí•˜ê³  hwyë¥¼ ê±¸ëŸ¬ë‚¸ ì´í›„ ì •ë ¬! ì•ì— 5ê°œë¥¼ ìœ„í•´ headë¥¼ ì‚¬ìš©í•˜ì. ë§Œì•½ì— descë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤ë©´, tailë¥¼ ì¨ì£¼ë©´ ëœë‹¤. ë¬¸ì œì—ì„œëŠ” 1ìœ„ë¶€í„° 5ìœ„ê¹Œì§€ ì°¨ë¡€ë¡œ ì¶œë ¥ì„ í•´ì¤˜ì•¼í•˜ë¯€ë¡œ tailì„ ë½‘ê³  arrange(desc())ë¥¼ ê±¸ì–´ì£¼ëŠ” ê²ƒì´ ì •ë‹µì¼ ê²ƒì´ë‹¤.

```R
# 7
> mpg %>% filter(manufacturer=="audi") %>% select(hwy) %>%
+   arrange(desc(hwy)) %>%  head(5)
  hwy
1  31
2  30
3  29
4  29
5  28
```

### 7ë²ˆ. mpg ë°ì´í„°ëŠ” ì—°ë¹„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë³€ìˆ˜ê°€ hwy(ê³ ì†ë„ë¡œ ì—°ë¹„), cty(ë„ì‹œ ì—°ë¹„), ë‘ ì¢…ë¥˜ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‘ ë³€ìˆ˜ë¥¼ ê°ê° í™œìš©í•˜ëŠ” ëŒ€ì‹  í•˜ë‚˜ì˜ í†µí•© ì—°ë¹„ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ ë¶„ì„í•˜ë ¤ê³  í•©ë‹ˆë‹¤.

#### -1ë²ˆ. mpg ë°ì´í„° ë³µì‚¬ë³¸ì„ ë§Œë“¤ê³ , ctyì™€ hwyë¥¼ ë”í•œ 'í•©ì‚° ì—°ë¹„ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”'

```R
# 8
mpg_1 = mpg %>% mutate(integrate_c_h = hwy + cty)
data.frame(mpg_1)
```

#### -2ë²ˆ. ì•ì—ì„œ ë§Œë“  'í•©ì‚° ì—°ë¹„ ë³€ìˆ˜'ë¥¼ 2ë¡œ ë‚˜ëˆ  'í‰ê·  ì—°ë¹„ ë³€ìˆ˜'ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.

```R
# 9
mpg_1 = mpg_1 %>% mutate(mean_c_h = integrate_c_h / 2)
data.frame(mpg_1)
```

#### -3ë²ˆ. 'í‰ê·  ì—°ë¹„ ë³€ìˆ˜'ê°€ ê°€ì¥ ë†’ì€ ìë™ì°¨ 3ì¢…ì˜ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ì„¸ìš”.

```R
# 10
mpg_1 %>% arrange(desc(mean_c_h)) %>% select(mean_c_h) %>% head(5)
```

#### -4ë²ˆ. 1~3ë²ˆ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” í•˜ë‚˜ë¡œ ì—°ê²°ëœ dplyr êµ¬ë¬¸ì„ ë§Œë“¤ì–´ ì‹¤í–‰í•´ë³´ì„¸ìš”. ë°ì´í„°ëŠ” ë³µì‚¬ë³¸ ëŒ€ì‹  mpgë¥¼ ì´ìš©í•˜ì„¸ìš”.

```R
# 11
mpg %>% mutate(mean_c_h = (hwy + cty) / 2) %>% arrange(desc(mean_c_h)) %>% head(5)
```

### 8ë²ˆ. mpg ë°ì´í„°ì˜ classëŠ” 'suv', 'compact' ë“± ìë™ì°¨ë¥¼ íŠ¹ì§•ì— ë”°ë¼ ì¼ê³± ì¢…ë¥˜ë¡œ ë¶„ë¥˜í•œ ë³€ìˆ˜ì…ë‹ˆë‹¤. ì–´ë–¤ ì°¨ì¢…ì˜ ë„ì‹œ ì—°ë¹„ê°€ ë†’ì€ì§€ ë¹„êµí•´ ë³´ë ¤ê³  í•©ë‹ˆë‹¤. classë³„ cty í‰ê· ì„ êµ¬í•´ ë³´ì„¸ìš”.

```R
# 12
mpg %>% group_by(class) %>% summarise(mean_cty = mean(cty))
```

### 9ë²ˆ. ì• ë¬¸ì œì˜ ì¶œë ¥ ê²°ê³¼ëŠ” class ê°’ ì•ŒíŒŒë²³ ìˆœìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì–´ë–¤ ì°¨ì¢…ì˜ ë„ì‹œ ì—°ë¹„ê°€ ë†’ì€ì§€ ì‰½ê²Œ ì•Œì•„ë³¼ ìˆ˜ ìˆë„ë¡ cty í‰ê· ì´ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬í•´ ì¶œë ¥í•˜ì„¸ìš”.

```R
# 13
mpg %>% group_by(class) %>% summarise(mean_cty = mean(cty)) %>% arrange(desc(mean_cty))
```

### 10ë²ˆ. ì–´ë–¤ íšŒì‚¬ ìë™ì°¨ì˜ hwy(ê³ ì†ë„ë¡œ ì—°ë¹„)ê°€ ê°€ì¥ ë†’ì€ì§€ ì•Œì•„ë³´ë ¤ê³  í•©ë‹ˆë‹¤. hwy í‰ê· ì´ ê°€ì¥ ë†’ì€ íšŒì‚¬ ì„¸ ê³³ì„ ì¶œë ¥í•˜ì„¸ìš”.

```R
# 14
mpg %>% group_by(manufacturer) %>% summarise(mean_hwy = mean(hwy)) %>% arrange(desc(mean_hwy)) %>% head(3)
```

### 11ë²ˆ. ì–´ë–¤ íšŒì‚¬ì—ì„œ "compact"(ê²½ì°¨) ì°¨ì¢…ì„ ê°€ì¥ ë§ì´ ìƒì‚°í•˜ëŠ”ì§€ ì•Œì•„ë³´ë ¤ê³  í•©ë‹ˆë‹¤. ê° íšŒì‚¬ë³„ "compact"ì°¨ì¢… ìˆ˜ë¥¼ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•´ë³´ì„¸ìš”.

```R
# 15
mpg %>% filter(class=="compact") %>% group_by(manufacturer) %>%
  summarise('count'=n()) %>%  arrange(desc(count))
```

## âŒ˜ ë°ì´í„° í•©ì¹˜ê¸° (join, bind)

í…Œì´ë¸”ì„ ì—¬ëŸ¬ ê°œ í•©ì³ì„œ ë¶„ì„í•´ì•¼í•˜ëŠ” ê²½ìš°, ì˜ˆë¥¼ ë“¤ì–´ ì¤‘ê°„ + ê¸°ë§ ë°ì´í„°ë¥¼ í•©ì³ì„œ ë¶„ì„í•´ì•¼ í•˜ëŠ” ê²½ìš° ë°ì´í„°ë¥¼ í•©ì³ì•¼í•œë‹¤. ë”°ë¡œë”°ë¡œ ë¶„ì„í•˜ê¸° ë³´ë‹¤ í•œë²ˆì— ëª¨ì•„ì„œ ë³´ëŠ” ê²ƒì´ í›¨ì”¬ í¸í•œ ê²½ìš°ì—ëŠ” ì´ëŸ¬í•œ join(ì—´)ì´ë‚˜ bind(í–‰)ë¥¼ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸” í•˜ë‚˜ë¡œ í•©ì¹˜ì.

### ê°€ë¡œ í•©ì¹˜ê¸°(ì—´ë¡œ í•©ì¹˜ê¸°)

```R
# 16
test1 = data.frame(id=c(1, 2, 3, 4, 5), 
                  midterm = c(60, 80, 70, 90, 85))

test2 = data.frame(id=c(1, 2, 3, 4, 5), 
                  final = c(70, 83, 65, 95, 80))

total = left_join(test1, test2, by="id")
total
```

### ì„¸ë¡œ í•©ì¹˜ê¸°(í–‰ìœ¼ë¡œ í•©ì¹˜ê¸°)

```R
# 17
test1 = data.frame(id=c(1, 2, 3, 4, 5), 
                   test = c(60, 80, 70, 90, 85))

test2 = data.frame(id=c(6, 7, 8, 9, 10), 
                   test = c(70, 83, 65, 95, 80))

total = bind_rows(test1, test2)
total
```

ì‚¬ì‹¤ ìœ„ì˜ ê²½ìš° Rì—ì„œëŠ” rbindì™€ cbindë¼ëŠ” ë‚´ì¥ í•¨ìˆ˜ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. í•˜ì§€ë§Œ, ì´ í•¨ìˆ˜ ë‚´ì— idì™€ ê°™ì´ í‚¤ ê°’ì„ ì´ìš©í•œ ì •ë ¬ ê¸°ëŠ¥ì—†ë‹¤. ë”°ë¼ì„œ Rì—ì„œëŠ” mergeí•¨ìˆ˜ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. mergeí•¨ìˆ˜ì—ì„œëŠ” ì™¸ë˜í‚¤ë¥¼ ì´ìš©í•œ joinì„ ì œê³µí•˜ë©°, ì´ë¥¼ ìœ„í•œ í‚¤ëŠ” join_leftí•¨ìˆ˜ì™€ ê°™ì´ byë¼ëŠ” ì˜µì…˜ ë˜ëŠ” ì¸ìë¥¼ ì œê³µí•œë‹¤. ë§Œì•½ì— outer joinì„ í•˜ê³  ì‹¶ë‹¤ë©´, all=TRUE ì˜µì…˜ì„ ë‹¬ì•„ì£¼ë©´ ë˜ê² ë‹¤. ì´ë•Œ all ì¸ìì˜ ê¸°ë³¸ê°’(default)ì€ FALSEì´ë‹¤.

---

## ì—°ìŠµë¬¸ì œ

ë¯¸êµ­ ë™ë¶ì¤‘ë¶€ 437ê°œ ì§€ì—­ì˜ ì¸êµ¬í†µê³„ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” midwest ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ ë°ì´í„° ë¶„ì„ ë¬¸ì œë¥¼ í•´ê²°í•˜ì. midwestëŠ” ggplot2 íŒ¨í‚¤ì§€ì— ë‚´ì¥ë˜ì–´ ìˆë‹¤.

``` R
# 18
library(ggplot2)
midwest = as.data.frame(ggplot2::midwest)
```

### 1ë²ˆ. popadultsëŠ” í•´ë‹¹ ì§€ì—­ì˜ ì„±ì¸ ì¸êµ¬. poptotalì€ ì „ì²´ ì¸êµ¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. midwestë°ì´í„°ì— 'ì „ì²´ ì¸êµ¬ ëŒ€ë¹„ ë¯¸ì„±ë…„ ì¸êµ¬ ë°±ë¶„ìœ¨' ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.

```R
# 19
midwest %>% mutate(ì „ì²´_ì¸êµ¬_ëŒ€ë¹„_ë¯¸ì„±ë…„_ì¸êµ¬_ë°±ë¶„ìœ¨ = (poptotal - popadults)/poptotal*100)
```

### 2ë²ˆ. ë¯¸ì„±ë…„ ì¸êµ¬ ë°±ë¶„ìœ¨ì´ ê°€ì¥ ë†’ì€ ìƒìœ„ 5ê°œ country(ì§€ì—­)ì˜ ë¯¸ì„±ë…„ ì¸êµ¬ ë°±ë¶„ìœ¨ì„ ì¶œë ¥í•˜ì„¸ìš”.

```R
# 20
midwest %>% arrange(desc(ì „ì²´_ì¸êµ¬_ëŒ€ë¹„_ë¯¸ì„±ë…„_ì¸êµ¬_ë°±ë¶„ìœ¨)) %>%
  select(county, ì „ì²´_ì¸êµ¬_ëŒ€ë¹„_ë¯¸ì„±ë…„_ì¸êµ¬_ë°±ë¶„ìœ¨) %>% head(5)
```

### 3ë²ˆ. ë¶„ë¥˜í‘œì˜ ê¸°ì¤€ì— ë”°ë¼ ë¯¸ì„±ë…„ ë¹„ìœ¨ ë“±ê¸‰ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ê³ , ê° ë“±ê¸‰ì— ëª‡ ê°œì˜ ì§€ì—­ì´ ìˆëŠ”ì§€ ì•Œì•„ë³´ì„¸ìš”.

Large: 40% ì´ìƒ

middle: 30 ~ 40% ë¯¸ë§Œ

small: 30% ë¯¸ë§Œ

ê°„ë‹¨í•˜ê²Œ ifelseêµ¬ë¶„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¡°ì‘í•˜ë©´ ëœë‹¤. Rì˜ ifë¬¸ ì¤‘ ê°œì¸ì ìœ¼ë¡œ ê°€ì¥ ì‚¬ìš©í•˜ê¸° í¸í•œê²Œ ifelse êµ¬ë¬¸ì´ë¼ ìƒê°í•œë‹¤.

```R
# 21
grade_midwest = midwest %>% mutate(grade=ifelse(ì „ì²´_ì¸êµ¬_ëŒ€ë¹„_ë¯¸ì„±ë…„_ì¸êµ¬_ë°±ë¶„ìœ¨>=40, 'large',
                                                   ifelse(ì „ì²´_ì¸êµ¬_ëŒ€ë¹„_ë¯¸ì„±ë…„_ì¸êµ¬_ë°±ë¶„ìœ¨>=30,'middle', 'small'))) %>% 
  select(grade)

table(grade_midwest)
grade_midwest
 large middle  small 
    32    396      9 
```

### 4ë²ˆ. popasianì€ í•´ë‹¹ ì§€ì—­ì˜ ì•„ì‹œì•„ì¸ ì¸êµ¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. 'ì „ì²´ ì¸êµ¬ ëŒ€ë¹„ ì•„ì‹œì•„ì¸ ì¸êµ¬ ë°±ë¶„ìœ¨' ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ê³  10ê°œ ì§€ì—­ì˜ state(ì£¼), country(ì§€ì—­), ì•„ì‹œì•„ì¸ ì¸êµ¬ ë°±ë¶„ìœ¨ì„ ì¶œë ¥í•˜ì„¸ìš”.

```R
# 22
midwest %>% mutate(ì „ì²´_ì¸êµ¬_ëŒ€ë¹„_ì•„ì‹œì•„ì¸_ì¸êµ¬_ë°±ë¶„ìœ¨=(popasian)/poptotal*100) %>%
  select(county, state, ì „ì²´_ì¸êµ¬_ëŒ€ë¹„_ì•„ì‹œì•„ì¸_ì¸êµ¬_ë°±ë¶„ìœ¨) %>%
  arrange(ì „ì²´_ì¸êµ¬_ëŒ€ë¹„_ì•„ì‹œì•„ì¸_ì¸êµ¬_ë°±ë¶„ìœ¨) %>%
  head(10)
```

ì´ìƒ ì •ë¦¬ ë!